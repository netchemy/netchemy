{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="{% static 'css/admin.css' %}">

     <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    

    
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Parkinsans:wght@300..800&display=swap" rel="stylesheet">

  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=settings" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=search" />
    <!--<script src="/static/js/script.js" defer></script>-->
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <ul>
                <li><a href="#" data-section="explore" class="nav-item">
                    <span class="material-symbols-outlined">search</span>
                    <span class="text">Explore</span></a>
                </li>
                <li><a href="#" data-section="earnings" class="nav-item">
                    <span class="material-icons-outlined">favorite</span>
                    <span class="text">Account</span></a>
                </li>
                <li><a href="#" data-section="profile" class="nav-item active">
                    <span class="material-icons-outlined">person</span>
                    <span class="text">Profile</span></a>
                </li>
                <li><a href="#" data-section="settings" class="nav-item">
                    <span class="material-icons-outlined">settings</span>
                    <span class="text">Settings</span></a>
                </li>
                
                
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <div class="content-section " id="earnings-content">
               
                    <!-- Payout Section -->
                    <div class="payout-section">

                        <div class="payout-history">
                            <h2>Acount KYC
                                <span class="info-icon">i
                                <span class="tooltip">Verifiy required to upload project</span>
                            </span></h2>
                            {% if kyc_verified == False or kyc_verified == None %}
                            <a href="{% url 'kyc' %}" class="verify-link">Verify Account</a>
                            {% else %}
                            <span>Verified</span>
                            {% endif %}
                        </div>
                        



                        <div class="payout-card">
                            <p id="noDataMessage" style="display: none; text-align: center; font-size: 16px; color: gray;">
                                No payout data available.
                            </p>
                            
                            <canvas id="payoutChart"></canvas>

                            <!-- Time Filters -->
                            <div class="time-filters">
                                <button>Last 7 days</button>
                                <button>Last 30 days</button>
                                <button>Last Year</button>
                            </div>

                        </div>
                        <!--<div class="payout-card">
                            <h2>Pending Payouts</h2>
                            <p>$1000.00</p>
                            <button class="withdraw-btn">Initiate Withdraw</button>
                        </div>-->


                        <!-- Linked Account Section -->
                        <div class="linked-account">
                            <h2>Bank Details</h2>
                            <form id="Bank-form" method="POST" enctype="multipart/form-data" 
                                action="{% if digits == 'N/A' %}{% url 'BankCard' %}{% else %}{% url 'EditBankCard' %}{% endif %}">
                                {% csrf_token %}
                                <input type="hidden" id="access_token" name="access_token" value="{{ access_token }}">

                                <div class="form-group1">
                                    <label for="title" class="form-label1">Account Holder Name</label>
                                    <input type="text" name="account-holder" id="account-holder" class="form-input1" 
                                        placeholder="Enter account holder's name" 
                                        value="{{ banks.AccountName|default_if_none:'' }}">
                                </div>
                                <div class="form-group1">
                                    <label for="title" class="form-label1">Mobile number</label>
                                    <input type="text" name="mobile-number" id="mobile-number" class="form-input1" 
                                        placeholder="Enter account holder's mobile number" 
                                        value="{{ banks.MobileNumber|default_if_none:'' }}">
                                </div>
                                <div class="form-group1">
                                    <label for="title" class="form-label1">Account Number</label>
                                    <input type="text" name="account-number" id="account-number" class="form-input1" 
                                        placeholder="Enter account number" 
                                        value="{{ banks.AccountNo|default_if_none:'' }}">
                                </div>

                                <div class="form-group1">
                                    <label for="title" class="form-label1">Bank Name</label>
                                    <input type="text" name="bank-name" id="bank-name" class="form-input1" 
                                        placeholder="Enter bank name" 
                                        value="{{ banks.BankName|default_if_none:'' }}">
                                </div>

                                <div class="form-group1">
                                    <label for="title" class="form-label1">IFSC Code</label>
                                    <input type="text" name="ifsc" id="ifsc" class="form-input1" 
                                        placeholder="Enter IFSC code" 
                                        value="{{ banks.IFSC|default_if_none:'' }}">
                                </div>

                                <div class="form-submit">
                                    <div class="account-actions">
                                        {% if digits == 'N/A' %}
                                            <button type="submit" class="Add">Add New</button>
                                        {% else %}
                                            <button type="submit" class="Add" style="display: block;">Edit</button>
                                        {% endif %}
                                    </div>
                                </div>
                            </form>

                            
                            
                        </div>

                    </div>

                    <h2 class = "trans">Transactions</h2>


                    <div id="transactions">
                        {% for transaction in transactions %}
                            <div class="transaction-item">
                                <p><strong>Withdraw Request ID:</strong> {{ transaction.id }}</p>
                                <p><strong>Amount:</strong> {{ transaction.Amount }}</p>
                                <p><strong>Status:</strong> {{ transaction.get_Status_display }}</p>
                            </div>
                        {% endfor %}
                    </div>
                    
                        <div id="pagination">
                            <button id="prevPage" {% if not transaction.has_previous %}disabled{% endif %}>Previous</button>
                            <span id="page-info">Page {{ transaction.number }} of {{ transaction.paginator.num_pages }}</span>
                            <button id="nextPage" {% if not transaction.has_next %}disabled{% endif %}>Next</button>
                        </div>

                    
                    
                    

                </div>
    
            <!--<div class="content-section " id="dashboard-content">
                <h2>Analytics</h2>
                <div class="tabs">
                    <button class="tab" data-section="resources">This week</button>
                    <button class="tab" data-section="courses">This month</button>
                    <button class="tab" data-section="portfolio">This year</button>
                </div>

         
                <div class="payout-section">
                    <div class="payout-card">
                        <h2>Total Listings</h2>
                        <p>10</p>
                    </div>

                    <div class="payout-card">
                        <h2>Purchases</h2>
                        <p>2</p>
                    </div>


  
                    <div class="linked-account">
                        <h3>Revenue</h3>
                        <p>$100.00</p>
                    </div>

                </div>


            </div>-->
    
            <div class="content-section active" id="profile-content">
                <header class="profile-header">
                    {% if account.ProfileImg %}
                        <img src="{{ account.ProfileImg.url }}" alt="Profile Picture" class="profile-picture">
                    {% else %}
                        <img src="{% static 'img/pro.png' %}" alt="Default Profile Picture" class="profile-picture">
                    {% endif %}
                    <div class="profile-details">
                        <h1>{{account.username}}</h1>
                        <p>{{account.role}}</p>
                    </div>
         

                    <div class="revenu-details">
                        <p>Earned</p>
                        <span id="amount"> ‚Çπ {{total_revenue}}</span>
                        <span class="eye-icon" onclick="toggleAmount()">üëÅÔ∏è</span>
                    </div>

                    <div class="withdraw-container">
                        <button id="withdraw-btn" class="edit-profile">
                            <span class="material-icons-outlined">account_balance_wallet</span> 
                        </button>
                        <div class="card19" id="withdraw-card">
                            <span class="close-btn" onclick="toggleCard()">‚úñ</span>
                            <h3>Withdraw Amount</h3>
                            <input type="number" placeholder="Enter amount" />
                            <button onclick="withdrawAmount()">Withdraw</button>
                        </div>
                    </div>

                  
                </header>
                
                <div class="tabs">
                    <button class="tab" data-section="resources">Add Project</button>
                    <button class="tab" data-section="courses">Analytics</button>
                    <!--<button class="tab" data-section="portfolio">Portfolio</button>-->
                </div>
    
                
                <div class="content" id="main-content">
                    
    
                    <div class="profile-section active" data-section="resources">
                        
                        <!-- Card container with scrollable overflow -->
                        <div class="cards-container">
                            <!-- "+" Button styled as a card -->
                            <div class="card add-card">
                                <button data-section="Project" class="add-resource">+</button>
                            </div>

                            {% for item in project %}
                                <!-- Example of a single card -->
                                <a href="{% url 'tempView' item.id%}">
                                <div class="card">
                                    <img src="{{item.PreviewImage.url}}" alt="Resource Image" class="card-image">
                                    <div class="card-content">
                                        <h3 class="card-title">{{ item.Title }}</h3>
                                        <p class="card-price">${{ item.price }}</p>
                                    </div>
                                </div>
                                </a>
                            {% endfor %}
                        </div>
                    </div>
                    
                    
                    
                    <div class="profile-section" data-section="courses">
                        
                        <div class = "payout-card">
                            <canvas id="payoutChartCanvas"></canvas>
                        </div>
                    </div>


                 
                    <div class="profile-section" data-section="portfolio">
                        <h2>Portfolio</h2>
                      
                    </div>
    
                </div>
            </div>
            

            
            <div class="content-section" id="explore-content">
                <div class="containers text-center">
                    <div class="d-flex flex-column justify-content-center align-items-center">
            
                        <a  class="mar-logo d-flex align-items-center">
                            <img src="{% static 'img/n3.svg' %}" alt="">
                            <h1 class="marketTitle">Marketplace</h1>
                        </a>
                         
                        <h1 data-aos="fade-up" class="market-sale-title">
                        Community-made <b class="highlight">codebases</b>, 
                        <b class="highlight">scripts</b>, 
                        <b class="highlight">interactions</b> and more
                        </h1>

                    </div>   
                    
                </div>  
                <form class="search-form" method="GET" action="{% url 'market_sale' %}">
                    <input type="text" name="q" class="search-input" placeholder="Search..." value="{{ query }}">
                    <button type="submit" class="search-button">Search</button>
                </form>
            </div>



            <div class="content-section" id="settings-content">
                <h2>Settings</h2>
                <div class="settings-options">
                    <div class="setting-item">
                        <form id="Profile-form" method="POST" enctype="multipart/form-data" action="{% url 'UploadProfilePic' %}">
                            {% csrf_token %}
                            <input type="hidden" id="access_token" name="access_token" value="{{ access_token }}">
                            <label for="ProfilePic">Profile Photo:</label>
                            <input type="file" id="ProfilePic" name="ProfilePic" accept="image/*">
                            <button id="change-Profile-btn">Save</button>
                        </form>
                    </div>
                    <form id="ChangePassword-form" method="POST" enctype="multipart/form-data" action="{% url 'ChangePassword' %}">
                        {% csrf_token %}
                        <input type="hidden" id="access_token" name="access_token" value="{{ access_token }}">
                        <div class="setting-item">
                            <label for="current-password">Current Password:</label>
                            <input type="password" id="current-password" name = "current-password" placeholder="Enter current password" required>
                        </div>
                        <div class="setting-item">
                            <label for="new-password">New Password:</label>
                            <input type="password" id="new-password" name = "new-password" placeholder="Enter new password" required>
                        </div>
                        <div class="setting-item">
                            <label for="new-password">Confirm New Password:</label>
                            <input type="password" id="confirm-new-password" name = "confirm-new-password" placeholder="Confirm new password" required>
                        </div>
                        <div class = "blll">
                            <button id="change-password-btn" type="submit">Change Password</button>
                        </div>
                    </form>
                    <div class = "blll">
                        <button id="logout-btn">Logout</button>
                    </div>
                </div>
            </div>
            
            <div class="content-section" id="settings-content">
                <h2>Settings</h2>
                <div class="settings-options">
                    <div class="setting-item">
                        <form id="Profile-form" method="POST" enctype="multipart/form-data" action="{% url 'UploadProfilePic' %}">
                            {% csrf_token %}
                            <input type="hidden" id="access_token" name="access_token" value="{{ access_token }}">
                            <label for="ProfilePic">Profile Photo:</label>
                            <input type="file" id="ProfilePic" name="ProfilePic" accept="image/*">
                            <button id="change-Profile-btn">Save</button>
                        </form>
                    </div>
                    <form id="ChangePassword-form" method="POST" enctype="multipart/form-data" action="{% url 'ChangePassword' %}">
                        {% csrf_token %}
                        <input type="hidden" id="access_token" name="access_token" value="{{ access_token }}">
                        <div class="setting-item">
                            <label for="current-password">Current Password:</label>
                            <input type="password" id="current-password" name = "current-password" placeholder="Enter current password" required>
                        </div>
                        <div class="setting-item">
                            <label for="new-password">New Password:</label>
                            <input type="password" id="new-password" name = "new-password" placeholder="Enter new password" required>
                        </div>
                        <div class="setting-item">
                            <label for="new-password">Confirm New Password:</label>
                            <input type="password" id="confirm-new-password" name = "confirm-new-password" placeholder="Confirm new password" required>
                        </div>
                        <div class = "blll">
                            <button id="change-password-btn" type="submit">Change Password</button>
                        </div>
                    </form>
                    <div class = "blll">
                        <button id="logout-btn">Logout</button>
                    </div>
                </div>
            </div>

            
            
            


           


           

            <div class="content-section" id="Project-content">
                <div class="upload-container">
                    <h1 class="upload-title">Upload Your Project</h1>
                    <form id="image-upload-form" method="POST" enctype="multipart/form-data" action="{% url 'Project_Upload'  %}">
                        {% csrf_token %}
                        <input type="hidden" id="access_token" name="access_token" value="{{ access_token }}">

                        <p id="error-message" style="color: red; display: none;"></p>

                        <div class="form-group1">
                            <label for="title" class="form-label1">Title</label>
                            <input type="text" name="title" id="title" class="form-input1" placeholder="Enter Title" required>
                        </div>
                    
                        <div class="form-group1">
                            <label for="description" class="form-label1">Description</label>
                            <textarea name="description" id="description" class="form-textarea1" placeholder="Enter Description" required></textarea>
                        </div>
                    
                        <div class="form-group1">
                            <label for="project-file" class="form-label1">Project File (ZIP)</label>
                            <input type="file" name="project_file" id="project-file" class="form-file1" accept=".zip">
                        </div>
                    
                        <div class="form-group1">
                            <label for="drive-link" class="form-label1">Drive Link</label>
                            <input type="url" name="drive_link" id="drive-link" class="form-input1" placeholder="Enter Drive Link">
                        </div>                    

                        <!--<div class="form-group1">
                            <label for="project-file" class="form-label1">Demo Video</label>
                            <input type="file" name="Demo_video" id="Demo_video" class="form-file1" accept=".mp4">
                        </div>-->
                    
                        <div class="form-group1">
                            <label for="whats-included" class="form-label1">What's Included</label>
                            <textarea name="whats-included" id="whats-included" class="form-textarea1" placeholder="What's included" required></textarea>
                        </div>
                    
                        <div class="currency-select-container">
                            <select name="currency" required>
                                <option value="INR">INR</option>
                                <option value="USD">USD</option>
                            </select>
                        </div>
                    
                        <div class="form-group1">
                            <label for="price" class="form-label1">Set Price</label>
                            <input type="text" name="price" id="price" class="form-input1" placeholder="Set 0 for free " required>
                        </div>
                    
                        <div class="form-group1">
                            <label for="preview-link" class="form-label1">Preview Link</label>
                            <input type="url" name="preview" id="preview-link" class="form-input1" placeholder="Preview Link" required>
                        </div>
                    
                        <!--<div class="form-group1">
                            <label for="PreviewImage" class="form-label1">Preview Image</label>
                            <input type="file" name="PreviewImage" id="PreviewImage" class="form-file1" accept="image/*">
                        </div>-->
                    
                        <div class="form-group1">
                            <label for="images" class="form-label1">Select Images</label>
                            <input type="file" name="images" id="images" class="form-file1" multiple accept="image/*" required>
                        </div>

                        <div class="form-submit">
                        <button type="submit" class="submit-button1">Upload Project</button>
                        </div >

                        <h3 class="preview-title1">Image Preview</h3>
                        <div id="image-preview" class="image-preview-container1"></div>
                    </form>
                    
                
                    
                </div>
            </div>
            

        </main>

        <!-- Mobile Bottom Navigation -->
        <nav class="mobile-bottom-nav">
            <ul>
                <li><a href="#" data-section="explore" class="nav-item">
                    <span class="material-symbols-outlined">search</span>
                </li>
                <li><a href="#" data-section="earnings" class="nav-item">
                    <span class="material-icons-outlined">favorite</span>
                </li>
                <li><a href="#" data-section="profile" class="nav-item active">
                    <span class="material-icons-outlined">person</span>
                </li>
                <li><a href="#" data-section="settings" class="nav-item">
                    <span class="material-icons-outlined">settings</span>
                </li>
                
            </ul>
        </nav>
    </div>
<!--functions-->
{% if messages %}
<script>
    {% for message in messages %}
        alert("{{ message|escapejs }}");
    {% endfor %}
    // Clear the message from session storage
    window.location.href = window.location.href.split("?")[0];
</script>
{% endif %}
<script>
    // Add interactivity if required, for example, toggling active tabs or other animations
document.addEventListener('DOMContentLoaded', () => {
    const tabs = document.querySelectorAll('.tabs .tab');
    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            tabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
        });
    });
});

</script>

<script>
    // Get all tab buttonsf
const tabs = document.querySelectorAll('.tab');
const sections = document.querySelectorAll('.profile-section');

// Add click event listener to each tab
tabs.forEach(tab => {
    tab.addEventListener('click', () => {
        // Remove 'active' class from all tabs and sections
        tabs.forEach(t => t.classList.remove('active'));
        sections.forEach(section => section.classList.remove('active'));

        // Add 'active' class to clicked tab and corresponding section
        tab.classList.add('active');
        const sectionId = tab.getAttribute('data-section');
        const activeSection = document.querySelector(`.profile-section[data-section="${sectionId}"]`);
        activeSection.classList.add('active');
    });
});

</script>



<script>
    document.getElementById("Profile-form").addEventListener("submit", function (event) {
        event.preventDefault(); // Prevent the default form submission
        const form = document.getElementById("Profile-form");
        const formData = new FormData(form);
    
        fetch(form.action, {
            method: "POST",
            body: formData,
            headers: {
                "X-CSRFToken": document.querySelector("[name=csrfmiddlewaretoken]").value,
            },
        })
        .then((response) => response.json()) // Parse JSON response
        .then((data) => {
            // Check if the response contains an error
            if (data.error) {
                alert(data.error); // Show error message in an alert
            } else if (data.success) {
                alert(data.success); // Show success message in an alert
            }
        })
        .catch((error) => {
            alert("An error occurred: " + error); // Catch any fetch-related errors and show them in alert
        });
    });
</script>


<script>
    // JavaScript to switch content when clicking sidebar items
const navItems = document.querySelectorAll('.sidebar .nav-item');
const contentSections = document.querySelectorAll('.main-content .content-section');

navItems.forEach(item => {
    item.addEventListener('click', function(event) {
        // Deactivate all items and hide all sections
        navItems.forEach(nav => nav.classList.remove('active'));
        contentSections.forEach(section => section.classList.remove('active'));

        // Activate the clicked item and corresponding section
        item.classList.add('active');
        const sectionId = item.getAttribute('data-section');
        const activeSection = document.getElementById(`${sectionId}-content`);
        activeSection.classList.add('active');
    });
});

</script>

<script>
    // JavaScript to switch content when clicking sidebar items
const MobileItems = document.querySelectorAll('.mobile-bottom-nav .nav-item');
const MobileSections = document.querySelectorAll('.main-content .content-section');

MobileItems.forEach(item => {
    item.addEventListener('click', function(event) {
        // Deactivate all items and hide all sections
        MobileItems.forEach(nav => nav.classList.remove('active'));
        MobileSections.forEach(section => section.classList.remove('active'));

        // Activate the clicked item and corresponding section
        item.classList.add('active');
        const sectionId = item.getAttribute('data-section');
        const activeSection = document.getElementById(`${sectionId}-content`);
        activeSection.classList.add('active');
    });
});

</script>

<script>
    // JavaScript to switch content when clicking sidebar items
const Project = document.querySelectorAll('.card .add-resource');
const ProjectForm = document.querySelectorAll('.main-content .content-section');

Project.forEach(item => {
    item.addEventListener('click', function(event) {
        // Deactivate all items and hide all sections
        Project.forEach(nav => nav.classList.remove('active'));
        ProjectForm.forEach(section => section.classList.remove('active'));

        // Activate the clicked item and corresponding section
        item.classList.add('active');
        const sectionId = item.getAttribute('data-section');
        const activeSection = document.getElementById(`${sectionId}-content`);
        activeSection.classList.add('active');
    });
});

</script>




<script>
     // JavaScript for previewing multiple selected images
     document.getElementById("images").addEventListener("change", function(event) {
        const previewContainer = document.getElementById("image-preview");
        previewContainer.innerHTML = ""; // Clear previous previews
        const files = event.target.files;

        Array.from(files).forEach(file => {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.createElement("img");
                img.src = e.target.result;
                img.classList.add("preview-image");
                previewContainer.appendChild(img);
            };
            reader.readAsDataURL(file);
        });
    });
       
</script>

<script>
    
        // Get the JWT token
        const accessToken = '{{ access_token }}';
        const refreshToken = '{{ refresh_token }}';

        // Store tokens 
        localStorage.setItem('access_token', accessToken);
        localStorage.setItem('refresh_token', refreshToken);



         // Get the token 
        const accessTokens = localStorage.getItem('access_token');
        if (accessTokens) {
            document.getElementById('access_token').value = accessTokens;
        }
</script>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        let ctx = document.getElementById("payoutChart").getContext("2d");
        let noDataMessage = document.getElementById("noDataMessage");
        let payoutChart;
    
        // Function to fetch and update chart data
        function updateChart(filter = "7days") {
            fetch(`/get_payout_data/?filter=${filter}`, {
                method: "GET",
                headers: {
                    "Authorization": `Bearer ${localStorage.getItem("access_token")}`
                }
            })
                .then(response => response.json())
                .then(data => {
                    let noDataMessage = document.getElementById("noDataMessage");
                    let chartCanvas = document.getElementById("payoutChart");
        
                    // Check if API returned a message
                    if (data.message) {
                        noDataMessage.textContent = data.message;
                        noDataMessage.style.display = "block";
                        chartCanvas.style.display = "none";
                        return;
                    }
        
                    // Hide message & show chart if data exists
                    noDataMessage.style.display = "none";
                    chartCanvas.style.display = "block";
        
                    let labels = data.map(item => item.date);
                    let values = data.map(item => item.amount);
        
                    if (payoutChart) {
                        payoutChart.destroy();
                    }
        
                    payoutChart = new Chart(ctx, {
                        type: "line",
                        data: {
                            labels: labels,
                            datasets: [{
                                label: "Successful Payouts (‚Çπ)",
                                data: values,
                                backgroundColor: "#0075FF",
                                borderColor: "#0075FF",
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: { beginAtZero: true }
                            }
                        }
                    });
                })
                .catch(error => console.error("Error fetching data:", error));
        }
        
    
        // Load initial data
        updateChart();
    
        // Event listeners for time filters
        document.querySelectorAll(".time-filters button").forEach(button => {
            button.addEventListener("click", function () {
                let filter = this.textContent.replace(" ", "").toLowerCase();
                updateChart(filter);
            });
        });
    });
    </script>
    

<script>
    let isHidden = false;
    let originalAmount = "{{ total_revenue }}"; 

    function toggleAmount() {
        const amount = document.getElementById("amount");
        const icon = document.querySelector(".eye-icon");

        if (isHidden) {
            amount.textContent = "‚Çπ"+originalAmount;  // Show the value
            icon.textContent = "üëÅÔ∏è"; // Eye open icon
        } else {
            amount.textContent = "****";  // Hide the value
            icon.textContent = "üëÅ‚Äçüó®"; // Eye closed icon
        }

        isHidden = !isHidden;
    }
</script>
<script>
    // Get the data from the Django template
    var payoutData = {
        total_listings: parseInt("{{ total_listings|default:0 }}"),
        total_purchases: parseInt("{{ total_purchases|default:0 }}"),
        total_revenue: parseFloat("{{ total_revenue|default:0 }}")
    };
    function renderChart(data) {
        var ctx = document.getElementById('payoutChartCanvas').getContext('2d');

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Total Listings', 'Purchases', 'Revenue'],
                datasets: [{
                    label: 'Sales Overview',
                    data: [data.total_listings, data.total_purchases, data.total_revenue],
                    borderColor: 'blue',
                    backgroundColor: 'rgba(0, 0, 255, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }


    renderChart(payoutData);
</script>

<script>
    document.getElementById("image-upload-form").addEventListener("submit", function(event) {
        var fileInput = document.getElementById("project-file");
        var linkInput = document.getElementById("drive-link");
        var errorMessage = document.getElementById("error-message");
    
        if (!fileInput.files.length && !linkInput.value.trim()) {
            errorMessage.textContent = "Please provide either a ZIP file or a Drive link.";
            errorMessage.style.display = "block";
            event.preventDefault(); 
        } else if (fileInput.files.length && linkInput.value.trim()) {
            errorMessage.textContent = "Please provide only one option: either a ZIP file or a Drive link.";
            errorMessage.style.display = "block";
            event.preventDefault();
        } else {
            errorMessage.style.display = "none";
        }
    });
    </script>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const logoutBtn = document.getElementById('logout-btn');
        
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async function() {
                    if (confirm("Are you sure you want to log out?")) {
                        try {
                            let response = await fetch('/logout/', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                }
                            });
        
                            if (!response.ok) {
                                throw new Error(`Server error: ${response.status}`);
                            }
        
                            let data = await response.json();
                            console.error("Logedout:", data.message);
                            // Remove tokens & redirect
                            localStorage.removeItem('access_token');
                            localStorage.removeItem('refresh_token');
                            window.location.href = '/';
                        } catch (error) {
                            alert("Error logging out. Please try again.");
                            console.error("Logout Error:", error);
                        }
                    }
                });
            } else {
                console.error("Logout button not found.");
            }
        });
        </script>
        
    <script>
        function toggleCard() {
            const card = document.getElementById('withdraw-card');
            card.classList.toggle('active');
        }

        document.getElementById('withdraw-btn').addEventListener('click', toggleCard);
    </script>

    <script>
    function withdrawAmount() {
        const amount = parseFloat(document.querySelector('#withdraw-card input[type="number"]').value);
        const totalRevenue = parseFloat("{{ total_revenue }}");
        const accessToken = localStorage.getItem('access_token');

        if (amount > totalRevenue) {
            alert('Insufficient balance in the wallet.');
            return;
        }

        fetch('/withdraw/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${accessToken}`
            },
            body: JSON.stringify({ amount: amount })
        })
        .then(response => response.json())
        .then(data => {
            if (data.message) {
                alert(data.message);
            } else {
                alert('Withdraw request submitted successfully.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred.');
        });
    }
    </script>
  
</body>
</html>
